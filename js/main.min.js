"use strict";var angPlayer=angular.module("angPlayer",["ngRoute","ngResource","ngAnimate"]);angPlayer.config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"/templates/appView.html",controller:"mainController"}).when("/album/:albumId",{templateUrl:"/templates/albumView.html",controller:"albumController"}).otherwise({redirectTo:"/"})}]),angPlayer.directive("audioPlayer",["dataProcessor","$rootScope",function(a,b){return{restrict:"A",link:function(){var c=document.getElementById("player");c.addEventListener("ended",function(){a.current++,a.playNext(),b.$apply()},!1)}}}]),angPlayer.directive("showHide",["$routeParams",function(a){return{restrict:"A",link:function(b){var c=document.querySelector(".menu");b.$on("$routeChangeSuccess",function(){var b=a;b.albumId?c.style.display="block":c.style.display="none"})}}}]),angPlayer.factory("dataSource",function(a){return{getData:function(){return a({url:"/data/dataAudio.json",method:"GET"})}}}),angPlayer.factory("dataProcessor",function(a,b,c,d,e){return{data:[],current:0,emptyPlaylist:function(){return this.data.length=0,this.current=0,this.data},deleteSong:function(a){this.data.splice(a,1),a<this.current?(this.current--,console.log("les thn current")):this.current===a&&(console.log("already playing..."),this.playNext())},playAll:function(a){return angular.forEach(a,function(a){this.data.push(a),this.data.length<2&&this.playNext()},this),this.data},getCollection:function(a){var b=a[0];if(this.data.length){var c=e("filter")(this.data,{pid:b.pid});c.length||this.data.push(b)}else this.data.push(b),this.playNext();return this.data},playThis:function(a){this.current=a,this.playNext()},play:function(a){c.src=a,c.play()},playNext:function(){var a=this.data[this.current];if(a){var b=a.media;this.play(b)}}}}),angPlayer.factory("audio",function(){var a=document.getElementById("player");return a}),angPlayer.controller("mainController",["$scope","dataSource","$location",function(a,b,c){b.getData().then(function(b){a.albums=b.data.records}),a.aClicked=function(a){var b="/album/"+a;c.path(b)}}]),angPlayer.controller("albumController",["$scope","dataSource","$filter","$routeParams","$rootScope",function(a,b,c,d,e){var f,g,h;b.getData().then(function(b){g=b.data.records,h=c("filter")(g,{pid:d.albumId}),h.length&&(f=h[0].subalbum,a.subalbum=f)}),a.songClicked=function(a){e.$broadcast("songClicked",a,f)}}]),angPlayer.controller("playListController",["$scope","dataSource","dataProcessor","$filter","$rootScope","$routeParams",function(a,b,c,d,e,f){a.$on("songClicked",function(b,e,f){var g=d("filter")(f,{pid:e});a.songs=c.getCollection(g)}),a.playAll=function(){var e;b.getData().then(function(b){var g=b.data.records;if(f.albumId){var h=d("filter")(g,{pid:f.albumId});e=h[0].subalbum,a.songs=c.playAll(e)}})},a.removeAll=function(){c.emptyPlaylist()},a.$watch(function(){return c.current},function(b){a.player=b}),a.playSong=function(a){c.playThis(a)},a.removeSong=function(a){c.deleteSong(a)}}]),angular.module("angPlayer").run(["$templateCache",function(a){a.put("templates/albumView.html",'<div class="row" style="position:relative"><ul id="songsList" class="thumbnails unstyled"><li id="song{{song.pid}}" data-spid="{{song.pid}}" class="cat plan" ng-repeat="song in subalbum" ng-click="songClicked(song.pid)"><img src="/images/{{song.image}}"><div class="plan-name-bronze"><h2>{{song.title}}</h2><p>{{song.artist}}</p><p>{{song.album}}-{{song.year}}</p></div></li></ul></div>'),a.put("templates/appView.html",'<div id="albumView"><div class="note" show-hide>Select an album to add songs in playlist.</div><div class="prod-list"><ul id="albumList" class="thumbnails unstyled"><li id="album{{album.pid}}" data-pid="{{album.pid}}" class="cat plan" ng-repeat="album in albums" ng-click="aClicked(album.pid)"><img src="/images/{{album.image}}"><div class="plan-name-bronze"><h2>{{album.artist}}</h2><h3>{{album.title}}</h3><p>{{album.years}}</p></div></li></ul></div></div>'),a.put("templates/playList.html",'<audio id="player" autoplay controls preload="none" src="" type="audio/mpeg"></audio><div id="songsCollection" ng-controller="playListController"><div class="menu" ng-hide="isVisible()"><a ng-href="#/" id="gotoHome"><i class="glyphicon glyphicon-home"></i> All Albums </a><a href="" id="playAll" ng-click="playAll()"><i class="glyphicon glyphicon-play"></i> Play All</a> <a href="" id="removeAll" ng-click="removeAll()"><i class="glyphicon glyphicon-trash"></i> Remove All</a></div><ul><li ng-repeat="song in songs" ng-class="{selected:player == $index}" ng-click="playSong($index)"><a class="song" href=""><img src="/images/{{song.image}}"> <span><i class="glyphicon glyphicon-music"></i></span>{{song.title}}</a> <a href="" ng-click="removeSong($index)" id="remove"><i class="glyphicon glyphicon-remove"></i></a></li></ul></div>')}]);